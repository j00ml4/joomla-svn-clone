<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Joomla! v1.5 UnitTest Platform</title>
<link rel="stylesheet" type="text/css" href="views/style.css" />
</head>
<body>
<?php if (JUNITTEST_LISTMODE_HEADER): ?>
	<h1 class="header" onclick="location.href='/unittest/'">
	<span>Joomla! v1.5 UnitTest Platform</span>
	</h1>

	<div id="userconfig">
	<strong>PHP:</strong> <span><?php echo PHP_VERSION; ?></span>
	<?php if (JUNITTEST_HOME_PHP4 != JUNITTEST_HOME_PHP5):
			$php4 = 'PHP4'; $php5 = 'PHP5';
			if (strpos(JUNITTEST_HOME_PHP4, $_SERVER['HTTP_HOST']) !== false) {
				$php4 = '<b class="tmessage" title="Current host">PHP4</b>';
			}
			if (strpos(JUNITTEST_HOME_PHP5, $_SERVER['HTTP_HOST']) !== false) {
				$php5 = '<b class="tmessage" title="Current host">PHP5</b>';
			}
	?>
		&nbsp; switch:
		<span><a class="tpass" href="<?php echo JUNITTEST_HOME_PHP4; ?>"><?php echo $php4; ?></a></span>
		<span><a class="tpass" href="<?php echo JUNITTEST_HOME_PHP5; ?>"><?php echo $php5; ?></a></span>
	<?php endif; ?>
	<br />

	<strong>User settings:</strong> <span><?php echo (!JUNITTEST_USERCONFIG) ? '<b class="tfail">missing</b>' : '<b class="tpass">enabled</b>'; ?></span><br />
	<strong>Test reporter:</strong> <span><?php echo JUNITTEST_REPORTER; ?></span><br />
	</div>
<?php endif; ?>

<?php
/* Loop through the tests and print a link for each one */

/* link decorator */
function testLink($infoobj) {
	return 'index.php?path='.$infoobj->path;
}
function docLink($infoobj, $file) {
	$fbase = basename($file);
	$label = ucfirst(substr(basename($file, '.txt'), 1+strlen($infoobj->classname)));
	$ahref = sprintf('<a href="%s" title="%s" target="_blank">',
				JUNITTEST_BASE .'/'. $infoobj->dirname .'_files/'. $fbase,
				$fbase);
	$a     = '</a>';
	return $ahref. $label . $a;
}
	$i = 0;
	foreach( $tests as $unittest ):
		if ($unittest->enabled) {
			$i++;
		}
		if ($unittest->is_test == JUNITTEST_IS_TESTSUITE) {
			$css  = 'testcasefolder';
			$hier = $unittest->dirname;
		} else {
			$css  = 'testcase';
			$hier = '';
		}
?>
	<div class="<?php echo $css; ?>">
	<?php if ( $unittest->enabled ): ?>
		<a href="<?php echo testLink($unittest); ?>">
		<?php echo $hier.$unittest->basename; ?>
		</a>
	<?php else: ?>
		<?php echo $hier.$unittest->basename; ?><sup>*)</sup>
	<?php endif; ?>

	<?php foreach ( $unittest->docs as $doc ): ?>
	&nbsp;<span class="docs"><?php echo docLink($unittest, $doc); ?></span>
	<?php endforeach;?>
	</div>

<?php endforeach;

if (JUNITTEST_LISTMODE_STATS) {
	$cfgs = get_defined_constants();
	$tpos = count(preg_grep("/^JUT\_*/", array_keys($cfgs)));
	echo '<pre>';
	$s = count($tests);
	if ( $i != $s ) {
		echo PHP_EOL, str_pad($i,    3, ' ', STR_PAD_LEFT), ' of ', $tpos, ' possible tests available.',
			 PHP_EOL, str_pad($s-$i, 3, ' ', STR_PAD_LEFT), ' existing tests are disabled via configuration';
	} else {
		echo PHP_EOL, 'All tests enabled.';
	}
	echo '</pre>';
}
?>

</body>
</html>
