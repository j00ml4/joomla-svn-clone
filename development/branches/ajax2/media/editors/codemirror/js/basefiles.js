function tokenizer(a,b){function c(a){return a!="\n"&&/^[\s\u00a0]*$/.test(a)}var d={state:b,take:function(b){typeof b=="string"&&(b={style:b,type:b}),b.content=(b.content||"")+a.get(),/\n$/.test(b.content)||a.nextWhile(c),b.value=b.content+a.get();return b},next:function(){if(!a.more())throw StopIteration;var b;if(a.equals("\n")){a.next();return this.take("whitespace")}if(a.applies(c))b="whitespace";else while(!b)b=this.state(a,function(a){d.state=a});return this.take(b)}};return d}function alwaysZero(){return 0}function makePartSpan(a){var b=a;a.nodeType==3?b=a.nodeValue:a=document.createTextNode(b);var c=document.createElement("SPAN");c.isPart=!0,c.appendChild(a),c.currentText=b;return c}function cleanText(a){return a.replace(/\u00a0/g," ").replace(/\u200b/g,"")}function fixSpaces(a){a.charAt(0)==" "&&(a=nbsp+a.slice(1));return a.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(a){return makeWhiteSpace(a.length)})}function makeWhiteSpace(a){var b=[],c=!0;for(;a>0;a--)b.push(c||a==1?nbsp:" "),c^=!0;return b.join("")}function UndoHistory(a,b,c,d){this.container=a,this.maxDepth=b,this.commitDelay=c,this.editor=d,this.parent=d.parent;var e={text:"",from:null,to:null};this.first=e,this.last=e,this.firstTouched=!1,this.history=[],this.redoHistory=[],this.touched=[]}function isSpan(a){var b=a.nodeName;return b=="SPAN"||b=="span"}function isBR(a){var b=a.nodeName;return b=="BR"||b=="br"}function nodeTop(a){var b=0;while(a.offsetParent)b+=a.offsetTop,a=a.offsetParent;return b}function nodeText(a){return a.textContent||a.innerText||a.nodeValue||""}function addEventHandler(a,b,c,d){function e(a){c(normalizeEvent(a||window.event))}if(typeof a.addEventListener=="function"){a.addEventListener(b,e,!1);if(d)return function(){a.removeEventListener(b,e,!1)}}else{a.attachEvent("on"+b,e);if(d)return function(){a.detachEvent("on"+b,e)}}}function normalizeEvent(a){a.stopPropagation||(a.stopPropagation=function(){this.cancelBubble=!0},a.preventDefault=function(){this.returnValue=!1}),a.stop||(a.stop=function(){this.stopPropagation(),this.preventDefault()}),a.type=="keypress"&&(a.code=a.charCode==null?a.keyCode:a.charCode,a.character=String.fromCharCode(a.code));return a}function isAncestor(a,b){while(b=b.parentNode)if(a==b)return!0;return!1}function clearElement(a){while(a.firstChild)a.removeChild(a.firstChild)}function removeElement(a){a.parentNode&&a.parentNode.removeChild(a)}function insertAfter(a,b){var c=b.parentNode;c.insertBefore(a,b.nextSibling);return a}function hasClass(a,b){var c=a.className;return c&&(new RegExp("(^| )"+b+"($| )")).test(c)}function matcher(a){return function(b){return a.test(b)}}function map(a,b){var c=[];forEach(a,function(a){c.push(b(a))});return c}function forEach(a,b){if(a.next)try{while(!0)b(a.next())}catch(c){if(c!=StopIteration)throw c}else for(var d=0;d<a.length;d++)b(a[d])}function method(a,b){return function(){a[b].apply(a,arguments)}}var StopIteration={toString:function(){return"StopIteration"}},nbsp="Â ",matching={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("},stringStream=function(a){function e(){while(c==b.length){d+=b,b="",c=0;try{b=a.next()}catch(e){if(e!=StopIteration)throw e;return!1}}return!0}var b="",c=0,d="";return{peek:function(){if(!e())return null;return b.charAt(c)},next:function(){if(!e())throw d.length>0?"End of stringstream reached without emptying buffer ('"+d+"').":StopIteration;return b.charAt(c++)},get:function(){var a=d;d="",c>0&&(a+=b.slice(0,c),b=b.slice(c),c=0);return a},push:function(a){b=b.slice(0,c)+a+b.slice(c)},lookAhead:function(e,f,g,h){function i(a){return h?a.toLowerCase():a}e=i(e);var j=!1,k=d,l=c;g&&this.nextWhileMatches(/[\s\u00a0]/);while(!0){var m=c+e.length,n=b.length-c;if(m<=b.length){j=e==i(b.slice(c,m)),c=m;break}if(e.slice(0,n)!=i(b.slice(c)))break;d+=b,b="";try{b=a.next()}catch(o){break}c=0,e=e.slice(n)}if(!j||!f)b=d.slice(k.length)+b,c=l,d=k;return j},more:function(){return this.peek()!==null},applies:function(a){var b=this.peek();return b!==null&&a(b)},nextWhile:function(a){var b;while((b=this.peek())!==null&&a(b))this.next()},matches:function(a){var b=this.peek();return b!==null&&a.test(b)},nextWhileMatches:function(a){var b;while((b=this.peek())!==null&&a.test(b))this.next()},equals:function(a){return a===this.peek()},endOfLine:function(){var a=this.peek();return a==null||a=="\n"}}},select={};(function(){function e(a){var b=a.nextSibling;if(b){while(b.firstChild)b=b.firstChild;return b.nodeType==3||isBR(b)?b:e(b)}var c=a.parentNode;while(c&&!c.nextSibling)c=c.parentNode;return c&&e(c)}function b(b,c){while(!b.previousSibling&&b.parentNode!=c)b=b.parentNode;return a(b.previousSibling,c)}function a(a,b){while(a&&a.parentNode!=b)a=a.parentNode;return a}select.ie_selection=document.selection&&document.selection.createRangeCollection;var c="Â Â Â Â ";select.scrollToNode=function(a,b){if(!!a){var c=a,d=document.body,e=document.documentElement,f=!c.nextSibling||!c.nextSibling.nextSibling||!c.nextSibling.nextSibling.nextSibling,g=0;while(c&&!c.offsetTop)g++,c=c.previousSibling;g==0&&(f=!1);if(webkit&&c&&c.offsetTop==5&&c.offsetLeft==5)return;var h=g*(c?c.offsetHeight:0),i=0,j=a?a.offsetWidth:0,k=c;while(k&&k.offsetParent)h+=k.offsetTop,isBR(k)||(i+=k.offsetLeft),k=k.offsetParent;var l=d.scrollLeft||e.scrollLeft||0,m=d.scrollTop||e.scrollTop||0,n=!1,o=window.innerWidth||e.clientWidth||0;if(b||j<o){if(b){var p=select.offsetInNode(a),q=nodeText(a).length;q&&(i+=j*(p/q))}var r=i-l;if(r<0||r>o)l=i,n=!0}var s=h-m;if(s<0||f||s>(window.innerHeight||e.clientHeight||0)-50)m=f?1e6:h,n=!0;n&&window.scrollTo(l,m)}},select.scrollToCursor=function(a){select.scrollToNode(select.selectionTopNode(a,!0)||a.firstChild,!0)};var d=null;select.snapshotChanged=function(){d&&(d.changed=!0)},select.snapshotReplaceNode=function(a,b,c,f){function g(g){a==g.node?(d.changed=!0,c&&g.offset>c?g.offset-=c:(g.node=b,g.offset+=f||0)):select.ie_selection&&g.offset==0&&g.node==e(a)&&(d.changed=!0)}!d||(g(d.start),g(d.end))},select.snapshotMove=function(a,b,c,e,f){function g(g){a==g.node&&(!f||g.offset==0)&&(d.changed=!0,g.node=b,e?g.offset=Math.max(0,g.offset+c):g.offset=c)}!d||(g(d.start),g(d.end))};if(select.ie_selection){function f(a){function d(a){while(a&&a.firstChild)a=a.firstChild;return{node:a,offset:0}}function c(a){var b=null;while(!b&&a)b=a.nextSibling,a=a.parentNode;return d(b)}var b=document.selection.createRange();b.collapse(a);var e=b.parentElement();if(!isAncestor(document.body,e))return null;if(!e.firstChild)return d(e);var f=b.duplicate();f.moveToElementText(e),f.collapse(!0);for(var g=e.firstChild;g;g=g.nextSibling){if(g.nodeType==3){var h=g.nodeValue.length;f.move("character",h)}else f.moveToElementText(g),f.collapse(!1);var i=b.compareEndPoints("StartToStart",f);if(i==0)return c(g);if(i==1)continue;if(g.nodeType!=3)return d(g);f.setEndPoint("StartToEnd",b);return{node:g,offset:h-f.text.length}}return c(e)}select.markSelection=function(){d=null;var a=document.selection;if(!!a){var b=f(!0),c=f(!1);if(!b||!c)return;d={start:b,end:c,changed:!1}}},select.selectMarked=function(){function a(a){var b=document.body.createTextRange(),c=a.node;if(!c)b.moveToElementText(document.body),b.collapse(!1);else if(c.nodeType==3){b.moveToElementText(c.parentNode);var d=a.offset;while(c.previousSibling)c=c.previousSibling,d+=(c.innerText||"").length;b.move("character",d)}else b.moveToElementText(c),b.collapse(!0);return b}if(!!d&&!!d.changed){var b=a(d.start),c=a(d.end);b.setEndPoint("StartToEnd",c),b.select()}},select.offsetInNode=function(a){var b=document.selection;if(!b)return 0;var c=b.createRange(),d=c.duplicate();try{d.moveToElementText(a)}catch(e){return 0}c.setEndPoint("StartToStart",d);return c.text.length},select.selectionTopNode=function(b,c){function h(a,b){if(b.nodeType==3){var c=0,d=b.previousSibling;while(d&&d.nodeType==3)c+=d.nodeValue.length,d=d.previousSibling;if(d){try{a.moveToElementText(d)}catch(e){return!1}a.collapse(!1)}else a.moveToElementText(b.parentNode);c&&a.move("character",c)}else try{a.moveToElementText(b)}catch(e){return!1}return!0}var d=document.selection;if(!d)return!1;var e=d.createRange(),f=e.duplicate();e.collapse(c);var g=e.parentElement();if(g&&isAncestor(b,g)){f.moveToElementText(g);if(e.compareEndPoints("StartToStart",f)==1)return a(g,b)}var c=0,i=b.childNodes.length-1;while(c<i){var j=Math.ceil((i+c)/2),k=b.childNodes[j];if(!k)return!1;if(!h(f,k))return!1;e.compareEndPoints("StartToStart",f)==1?c=j:i=j-1}if(c==0){var l=d.createRange(),m=l.duplicate();try{m.moveToElementText(b)}catch(n){return null}if(l.compareEndPoints("StartToStart",m)==0)return null}return b.childNodes[c]||null},select.focusAfterNode=function(a,b){var c=document.body.createTextRange();c.moveToElementText(a||b),c.collapse(!a),c.select()},select.somethingSelected=function(){var a=document.selection;return a&&a.createRange().text!=""};function g(a){var b=document.selection;if(b){var c=b.createRange();c.pasteHTML(a),c.collapse(!1),c.select()}}select.insertNewlineAtCursor=function(){g("<br>")},select.insertTabAtCursor=function(){g(c)},select.cursorPos=function(a,b){var c=document.selection;if(!c)return null;var d=select.selectionTopNode(a,b);while(d&&!isBR(d))d=d.previousSibling;var e=c.createRange(),f=e.duplicate();e.collapse(b);if(d)f.moveToElementText(d),f.collapse(!1);else{try{f.moveToElementText(a)}catch(g){return null}f.collapse(!0)}e.setEndPoint("StartToStart",f);return{node:d,offset:e.text.length}},select.setCursorPos=function(a,b,c){function d(b){var c=document.body.createTextRange();b.node?(c.moveToElementText(b.node),c.collapse(!1)):(c.moveToElementText(a),c.collapse(!0)),c.move("character",b.offset);return c}var e=d(b);c&&c!=b&&e.setEndPoint("EndToEnd",d(c)),e.select()},select.getBookmark=function(a){var b=select.cursorPos(a,!0),c=select.cursorPos(a,!1);if(b&&c)return{from:b,to:c}},select.setBookmark=function(a,b){!b||select.setCursorPos(a,b.from,b.to)}}else{function h(a,b){while(a.nodeType!=3&&!isBR(a)){var c=a.childNodes[b]||a.nextSibling;b=0;while(!c&&a.parentNode)a=a.parentNode,c=a.nextSibling;a=c;if(!c)break}return{node:a,offset:b}}select.markSelection=function(){var a=window.getSelection();if(!a||a.rangeCount==0)return d=null;var b=a.getRangeAt(0);d={start:h(b.startContainer,b.startOffset),end:h(b.endContainer,b.endOffset),changed:!1}},select.selectMarked=function(){function e(a,b){a.node?a.offset==0?c["set"+b+"Before"](a.node):c["set"+b](a.node,a.offset):c.setStartAfter(document.body.lastChild||document.body)}function b(){if(a.start.node==a.end.node&&a.start.offset==a.end.offset){var b=window.getSelection();if(!b||b.rangeCount==0)return!0;var c=b.getRangeAt(0),d=h(c.startContainer,c.startOffset);return a.start.node!=d.node||a.start.offset!=d.offset}}var a=d;if(!!a&&!!(a.changed||webkit&&b())){var c=document.createRange();e(a.end,"End"),e(a.start,"Start"),i(c)}};function i(a){var b=window.getSelection();!b||(b.removeAllRanges(),b.addRange(a))}function j(){var a=window.getSelection();return!a||a.rangeCount==0?!1:a.getRangeAt(0)}select.selectionTopNode=function(c,d){var e=j();if(!e)return!1;var f=d?e.startContainer:e.endContainer,g=d?e.startOffset:e.endOffset;window.opera&&!d&&e.endContainer==c&&e.endOffset==e.startOffset+1&&c.childNodes[e.startOffset]&&isBR(c.childNodes[e.startOffset])&&g--;return f.nodeType==3?g>0?a(f,c):b(f,c):f.nodeName.toUpperCase()=="HTML"?g==1?null:c.lastChild:f==c?g==0?null:f.childNodes[g-1]:g==f.childNodes.length?a(f,c):g==0?b(f,c):a(f.childNodes[g-1],c)},select.focusAfterNode=function(a,b){var c=document.createRange();c.setStartBefore(b.firstChild||b),a&&!a.firstChild?c.setEndAfter(a):a?c.setEnd(a,a.childNodes.length):c.setEndBefore(b.firstChild||b),c.collapse(!1),i(c)},select.somethingSelected=function(){var a=j();return a&&!a.collapsed},select.offsetInNode=function(a){var b=j();if(!b)return 0;b=b.cloneRange(),b.setStartBefore(a);return b.toString().length},select.insertNodeAtCursor=function(a){var b=j();if(!!b){b.deleteContents(),b.insertNode(a),webkitLastLineHack(document.body);if(window.opera&&isBR(a)&&isSpan(a.parentNode)){var c=a.nextSibling,d=a.parentNode,e=d.parentNode;e.insertBefore(a,d.nextSibling);var f="";for(;c&&c.nodeType==3;c=c.nextSibling)f+=c.nodeValue,removeElement(c);e.insertBefore(makePartSpan(f,document),a.nextSibling)}b=document.createRange(),b.selectNode(a),b.collapse(!1),i(b)}},select.insertNewlineAtCursor=function(){select.insertNodeAtCursor(document.createElement("BR"))},select.insertTabAtCursor=function(){select.insertNodeAtCursor(document.createTextNode(c))},select.cursorPos=function(a,b){var c=j();if(!!c){var d=select.selectionTopNode(a,b);while(d&&!isBR(d))d=d.previousSibling;c=c.cloneRange(),c.collapse(b),d?c.setStartAfter(d):c.setStartBefore(a);var e=c.toString();return{node:d,offset:e.length}}},select.setCursorPos=function(a,b,c){function e(b,c,e){function g(a){a.nodeType==3?f.push(a):forEach(a.childNodes,g)}if(c==0&&b&&!b.nextSibling){d["set"+e+"After"](b);return!0}b?b=b.nextSibling:b=a.firstChild;if(!!b){if(c==0){d["set"+e+"Before"](b);return!0}var f=[];while(!0){while(b&&!f.length)g(b),b=b.nextSibling;var h=f.shift();if(!h)return!1;var i=h.nodeValue.length;if(i>=c){d["set"+e](h,c);return!0}c-=i}}}var d=document.createRange();c=c||b,e(c.node,c.offset,"End")&&e(b.node,b.offset,"Start")&&i(d)}}})(),UndoHistory.prototype={scheduleCommit:function(){var a=this;this.parent.clearTimeout(this.commitTimeout),this.commitTimeout=this.parent.setTimeout(function(){a.tryCommit()},this.commitDelay)},touch:function(a){this.setTouched(a),this.scheduleCommit()},undo:function(){this.commit();if(this.history.length){var a=this.history.pop();this.redoHistory.push(this.updateTo(a,"applyChain")),this.notifyEnvironment();return this.chainNode(a)}},redo:function(){this.commit();if(this.redoHistory.length){var a=this.redoHistory.pop();this.addUndoLevel(this.updateTo(a,"applyChain")),this.notifyEnvironment();return this.chainNode(a)}},clear:function(){this.history=[],this.redoHistory=[]},historySize:function(){return{undo:this.history.length,redo:this.redoHistory.length}},push:function(a,b,c){var d=[];for(var e=0;e<c.length;e++){var f=e==c.length-1?b:this.container.ownerDocument.createElement("BR");d.push({from:a,to:f,text:cleanText(c[e])}),a=f}this.pushChains([d],a==null&&b==null),this.notifyEnvironment()},pushChains:function(a,b){this.commit(b),this.addUndoLevel(this.updateTo(a,"applyChain")),this.redoHistory=[]},chainNode:function(a){for(var b=0;b<a.length;b++){var c=a[b][0],d=c&&(c.from||c.to);if(d)return d}},reset:function(){this.history=[],this.redoHistory=[]},textAfter:function(a){return this.after(a).text},nodeAfter:function(a){return this.after(a).to},nodeBefore:function(a){return this.before(a).from},tryCommit:function(){!window||!window.parent||!window.UndoHistory||(this.editor.highlightDirty()?this.commit(!0):this.scheduleCommit())},commit:function(a){this.parent.clearTimeout(this.commitTimeout),a||this.editor.highlightDirty(!0);var b=this.touchedChains(),c=this;b.length&&(this.addUndoLevel(this.updateTo(b,"linkChain")),this.redoHistory=[],this.notifyEnvironment())},updateTo:function(a,b){var c=[],d=[];for(var e=0;e<a.length;e++)c.push(this.shadowChain(a[e])),d.push(this[b](a[e]));b=="applyChain"&&this.notifyDirty(d);return c},notifyDirty:function(a){forEach(a,method(this.editor,"addDirtyNode")),this.editor.scheduleHighlight()},notifyEnvironment:function(){this.onChange&&this.onChange(),window.frameElement&&window.frameElement.CodeMirror.updateNumbers&&window.frameElement.CodeMirror.updateNumbers()},linkChain:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.from?c.from.historyAfter=c:this.first=c,c.to?c.to.historyBefore=c:this.last=c}},after:function(a){return a?a.historyAfter:this.first},before:function(a){return a?a.historyBefore:this.last},setTouched:function(a){a?a.historyTouched||(this.touched.push(a),a.historyTouched=!0):this.firstTouched=!0},addUndoLevel:function(a){this.history.push(a),this.history.length>this.maxDepth&&this.history.shift()},touchedChains:function(){function g(a,b){var c=b+"Sibling",d=a[c];while(d&&!isBR(d))d=d[c];return d}function e(b){var c=[];for(var d=b?b.nextSibling:a.container.firstChild;d&&(!isBR(d)||d.hackBR);d=d.nextSibling)!d.hackBR&&d.currentText&&c.push(d.currentText);return{from:b,to:d,text:cleanText(c.join(""))}}function d(a,c){a?a.historyTemp=c:b=c}function c(a){return a?a.historyTemp:b}var a=this,b=null,f=[];a.firstTouched&&a.touched.push(null),forEach(a.touched,function(b){if(!b||b.parentNode==a.container&&!b.hackBR){b?b.historyTouched=!1:a.firstTouched=!1;var c=e(b),g=a.after(b);if(!g||g.text!=c.text||g.to!=c.to)f.push(c),d(b,c)}});var h=[];a.touched=[],forEach(f,function(b){if(!!c(b.from)){var f=[],i=b.from,j=!0;while(!0){var k=c(i);if(!k){if(j)break;k=e(i)}f.unshift(k),d(i,null);if(!i)break;j=a.after(i),i=g(i,"previous")}i=b.to,j=a.before(b.from);while(!0){if(!i)break;var k=c(i);if(!k){if(j)break;k=e(i)}f.push(k),d(i,null),j=a.before(i),i=g(i,"next")}h.push(f)}});return h},shadowChain:function(a){var b=[],c=this.after(a[0].from),d=a[a.length-1].to;while(!0){b.push(c);var e=c.to;if(!e||e==d)break;c=e.historyAfter||this.before(d)}return b},applyChain:function(a){function d(a,b){var d=a?a.nextSibling:c.container.firstChild;while(d!=b){var e=d.nextSibling;removeElement(d),d=e}}var b=select.cursorPos(this.container,!1),c=this,e=a[0].from,f=a[a.length-1].to;d(e,f);for(var g=0;g<a.length;g++){var h=a[g];g>0&&c.container.insertBefore(h.from,f);var i=makePartSpan(fixSpaces(h.text));c.container.insertBefore(i,f);if(b&&b.node==h.from){var j=0,k=this.after(h.from);if(k&&g==a.length-1){for(var l=0;l<b.offset&&h.text.charAt(l)==k.text.charAt(l);l++){}b.offset>l&&(j=h.text.length-k.text.length)}select.setCursorPos(this.container,{node:h.from,offset:Math.max(0,b.offset+j)})}else b&&g==a.length-1&&b.node&&b.node.parentNode!=this.container&&select.setCursorPos(this.container,{node:h.from,offset:h.text.length})}this.linkChain(a);return e}};var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computer, Inc/.test(navigator.vendor),gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);gecko&&(gecko=Number(gecko[1]));var mac=/Mac/.test(navigator.platform),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent),slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent),webkitLastLineHack=webkit?function(a){var b=a.lastChild;if(!b||!b.hackBR){var c=document.createElement("BR");c.hackBR=!0,a.appendChild(c)}}:function(){},Editor=function(){function k(a){return a>=16&&a<=18||a>=33&&a<=40}function j(a){this.options=a,window.indentUnit=a.indentUnit,this.parent=parent;var b=this.container=document.body;this.history=new UndoHistory(b,a.undoDepth,a.undoDelay,this);var c=this;if(!j.Parser)throw"No parser loaded.";a.parserConfig&&j.Parser.configure&&j.Parser.configure(a.parserConfig),!a.readOnly&&!internetExplorer&&select.setCursorPos(b,{node:null,offset:0}),this.dirty=[],this.importCode(a.content||""),this.history.onChange=a.onChange;if(!a.readOnly){a.continuousScanning!==!1&&(this.scanner=this.documentScanner(a.passTime),this.delayScanning());function d(){document.body.contentEditable!=undefined&&internetExplorer?document.body.contentEditable="true":document.designMode="on",internetExplorer&&a.height!="dynamic"&&(document.body.style.minHeight=frameElement.clientHeight-2*document.body.offsetTop-5+"px"),document.documentElement.style.borderWidth="0",a.textWrapping||(b.style.whiteSpace="nowrap")}try{d()}catch(e){var f=addEventHandler(document,"focus",function(){f(),d()},!0)}addEventHandler(document,"keydown",method(this,"keyDown")),addEventHandler(document,"keypress",method(this,"keyPress")),addEventHandler(document,"keyup",method(this,"keyUp"));function g(){c.cursorActivity(!1)}addEventHandler(internetExplorer?document.body:window,"mouseup",g),addEventHandler(document.body,"cut",g),gecko&&addEventHandler(window,"pagehide",function(){c.unloaded=!0}),addEventHandler(document.body,"paste",function(a){g();var b=null;try{var d=a.clipboardData||window.clipboardData;d&&(b=d.getData("Text"))}catch(e){}b!==null&&(a.stop(),c.replaceSelection(b),select.scrollToCursor(c.container))}),this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}else a.textWrapping||(b.style.whiteSpace="nowrap")}function i(a,b,c,d){function e(b){var c=cleanText(a.history.textAfter(b));return d?c.toLowerCase():c}this.editor=a,this.history=a.history,this.history.commit(),this.valid=!!b,this.atOccurrence=!1,d==undefined&&(d=b==b.toLowerCase());var f={node:null,offset:0};if(c&&typeof c=="object"&&typeof c.character=="number"){a.checkLine(c.line);var g={node:c.line,offset:c.character};this.pos={from:g,to:g}}else c?this.pos={from:select.cursorPos(a.container,!0)||f,to:select.cursorPos(a.container,!1)||f}:this.pos={from:f,to:f};d&&(b=b.toLowerCase());var h=b.split("\n");this.matches=h.length==1?function(a,c,d){var f=e(c),g=b.length,h;if(a?d>=g&&(h=f.lastIndexOf(b,d-g))!=-1:(h=f.indexOf(b,d))!=-1)return{from:{node:c,offset:h},to:{node:c,offset:h+g}}}:function(a,b,c){var d=a?h.length-1:0,f=h[d],g=e(b),i=a?g.indexOf(f)+f.length:g.lastIndexOf(f);if(a?i<c&&i==f.length:i>c&&i==g.length-f.length){var j=b;while(!0){if(a&&!j)return;j=a?this.history.nodeBefore(j):this.history.nodeAfter(j);if(!a&&!j)return;g=e(j),f=h[a?--d:++d];if(d>0&&d<h.length-1){if(g!=f)return;continue}var k=a?g.lastIndexOf(f):g.indexOf(f)+f.length;if(a?k!=g.length-f.length:k!=f.length)return;return{from:{node:a?j:b,offset:a?k:i},to:{node:a?b:j,offset:a?i:k}}}}}}function h(){return(new Date).getTime()}function g(a,b){a?isBR(a)&&(a=a.nextSibling):a=b.firstChild;while(a&&!isBR(a))a=a.nextSibling;return a}function f(a){while(a&&!isBR(a))a=a.previousSibling;return a}function e(a){return isBR(a)?1:a.currentText.length}function d(a){function j(){if(!a)throw StopIteration;var c=a;a=c.nextSibling;if(i(c)){b.push(c),f=!1;return c.currentText}if(isBR(c)){f&&window.opera&&c.parentNode.insertBefore(makePartSpan(""),c),b.push(c),f=!0;return"\n"}var g=!c.nextSibling;e=d(c),removeElement(c);return h(c,g)}function i(a){if(a.isPart&&a.childNodes.length==1&&a.firstChild.nodeType==3){a.currentText=a.firstChild.nodeValue;return!/[\n\t\r]/.test(a.currentText)}return!1}function h(a,b){var d=c(a,b);for(var e=0;e<d.length;e++)d[e]=g(d[e]);return d.join("")}function g(a){var c="\n";a.nodeType==3?(select.snapshotChanged(),a=makePartSpan(a),c=a.currentText,f=!1):(f&&window.opera&&e(makePartSpan("")),f=!0),a.dirty=!0,b.push(a),e(a);return c}function d(a){var b=a.parentNode,c=a.nextSibling;return function(a){b.insertBefore(a,c)}}var b=[],e=null,f=!0;return{next:j,nodes:b}}function c(b,c){function f(b,g){if(b.nodeType==3){var h=b.nodeValue=fixSpaces(b.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "));h.length&&(e=!1),d.push(b)}else if(isBR(b)&&b.childNodes.length==0)e=!0,d.push(b);else{for(var i=b.firstChild;i;i=i.nextSibling)f(i);!e&&a.hasOwnProperty(b.nodeName.toUpperCase())&&(e=!0,(!c||!g)&&d.push(document.createElement("BR")))}}var d=[],e=!0;f(b,!0);return d}function b(a){var b=makeWhiteSpace(indentUnit);return map(a.replace(/\t/g,b).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}var a={P:!0,DIV:!0,LI:!0};i.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function f(){var a={node:d,offset:e};b.pos={from:a,to:a},b.atOccurrence=!1;return!1}if(!this.valid)return!1;var b=this,c=a?this.pos.from:this.pos.to,d=c.node,e=c.offset;d&&!d.parentNode&&(d=null,e=0);while(!0){if(this.pos=this.matches(a,d,e)){this.atOccurrence=!0;return!0}if(a){if(!d)return f();d=this.history.nodeBefore(d),e=this.history.textAfter(d).length}else{var g=this.history.nodeAfter(d);if(!g){e=this.history.textAfter(d).length;return f()}d=g,e=0}}},select:function(){this.atOccurrence&&(select.setCursorPos(this.editor.container,this.pos.from,this.pos.to),select.scrollToCursor(this.editor.container))},replace:function(a){if(this.atOccurrence){var b=this.editor.replaceRange(this.pos.from,this.pos.to,a);this.pos.to=b,this.atOccurrence=!1}},position:function(){if(this.atOccurrence)return{line:this.pos.from.node,character:this.pos.from.offset}}},j.prototype={importCode:function(a){this.history.push(null,null,b(a)),this.history.reset()},getCode:function(){if(!this.container.firstChild)return"";var a=[];select.markSelection(),forEach(d(this.container.firstChild),method(a,"push")),select.selectMarked(),webkit&&this.container.lastChild.hackBR&&a.pop(),webkitLastLineHack(this.container);return cleanText(a.join(""))},checkLine:function(a){if(a===!1||a!=null&&a.parentNode!=this.container)throw parent.CodeMirror.InvalidLineHandle},cursorPosition:function(a){a==null&&(a=!0);var b=select.cursorPos(this.container,a);return b?{line:b.node,character:b.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){return this.container.lastChild?f(this.container.lastChild):null},nextLine:function(a){this.checkLine(a);var b=g(a,this.container);return b||!1},prevLine:function(a){this.checkLine(a);if(a==null)return!1;return f(a.previousSibling)},visibleLineCount:function(){var a=this.container.firstChild;while(a&&isBR(a))a=a.nextSibling;if(!a)return!1;var b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return Math.floor(b/a.offsetHeight)},selectLines:function(a,b,c,d){this.checkLine(a);var e={node:a,offset:b},f=null;d!==undefined&&(this.checkLine(c),f={node:c,offset:d}),select.setCursorPos(this.container,e,f),select.scrollToCursor(this.container)},lineContent:function(a){var b=[];for(a=a?a.nextSibling:this.container.firstChild;a&&!isBR(a);a=a.nextSibling)b.push(nodeText(a));return cleanText(b.join(""))},setLineContent:function(a,b){this.history.commit(),this.replaceRange({node:a,offset:0},{node:a,offset:this.history.textAfter(a).length},b),this.addDirtyNode(a),this.scheduleHighlight()},removeLine:function(a){var b=a?a.nextSibling:this.container.firstChild;while(b){var c=b.nextSibling;removeElement(b);if(isBR(b))break;b=c}this.addDirtyNode(a),this.scheduleHighlight()},insertIntoLine:function(a,c,d){var e=null;if(c=="end")e=g(a,this.container);else for(var f=a?a.nextSibling:this.container.firstChild;f;f=f.nextSibling){if(c==0){e=f;break}var h=nodeText(f);if(h.length>c){e=f.nextSibling,d=h.slice(0,c)+d+h.slice(c),removeElement(f);break}c-=h.length}var i=b(d);for(var j=0;j<i.length;j++)j>0&&this.container.insertBefore(document.createElement("BR"),e),this.container.insertBefore(makePartSpan(i[j]),e);this.addDirtyNode(a),this.scheduleHighlight()},selectedText:function(){var a=this.history;a.commit();var b=select.cursorPos(this.container,!0),c=select.cursorPos(this.container,!1);if(!b||!c)return"";if(b.node==c.node)return a.textAfter(b.node).slice(b.offset,c.offset);var d=[a.textAfter(b.node).slice(b.offset)];for(var e=a.nodeAfter(b.node);e!=c.node;e=a.nodeAfter(e))d.push(a.textAfter(e));d.push(a.textAfter(c.node).slice(0,c.offset));return cleanText(d.join("\n"))},replaceSelection:function(a){this.history.commit();var b=select.cursorPos(this.container,!0),c=select.cursorPos(this.container,!1);!!b&&!!c&&(c=this.replaceRange(b,c,a),select.setCursorPos(this.container,c),webkitLastLineHack(this.container))},cursorCoords:function(a){function g(a,b){var c=document.createElement("SPAN");c.appendChild(document.createTextNode(a));try{return b(c)}finally{c.parentNode&&c.parentNode.removeChild(c)}}function f(a,b){var c=-(document.body.scrollTop||document.documentElement.scrollTop||0),d=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+b;forEach([a,window.frameElement],function(a){while(a)d+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent});return{x:d,y:c,yBot:c+a.offsetHeight}}var b=select.cursorPos(this.container,a);if(!b)return null;var c=b.offset,d=b.node,e=this;while(c){d=d?d.nextSibling:this.container.firstChild;var h=nodeText(d);if(c<h.length)return g(h.substr(0,c),function(a){a.style.position="absolute",a.style.visibility="hidden",a.className=d.className,e.container.appendChild(a);return f(d,a.offsetWidth)});c-=h.length}return d&&isSpan(d)?f(d,d.offsetWidth):d&&d.nextSibling&&isSpan(d.nextSibling)?f(d.nextSibling,0):g("â€‹",function(a){d?d.parentNode.insertBefore(a,d.nextSibling):e.container.insertBefore(a,e.container.firstChild);return f(a,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera||gecko&&gecko>=20101026)){this.capturingPaste=!0;var a=window.frameElement.CodeMirror.textareaHack;parent.focus(),a.value="",a.focus();var b=this;this.parent.setTimeout(function(){b.capturingPaste=!1,window.focus(),b.selectionSnapshot&&window.select.setBookmark(b.container,b.selectionSnapshot);var c=a.value;c&&(b.replaceSelection(c),select.scrollToCursor(b.container))},10)}},replaceRange:function(a,c,d){var e=b(d);e[0]=this.history.textAfter(a.node).slice(0,a.offset)+e[0];var f=e[e.length-1];e[e.length-1]=f+this.history.textAfter(c.node).slice(c.offset);var g=this.history.nodeAfter(c.node);this.history.push(a.node,g,e);return{node:this.history.nodeBefore(g),offset:f.length}},getSearchCursor:function(a,b,c){return new i(this,a,b,c)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(a){if(!select.somethingSelected())this.indentAtCursor(a);else{var b=select.selectionTopNode(this.container,!0),c=select.selectionTopNode(this.container,!1);if(b===!1||c===!1)return;this.indentRegion(b,c,a)}},grabKeys:function(a,b){this.frozen=a,this.keyFilter=b},ungrabKeys:function(){this.frozen="leave"},setParser:function(a,b){j.Parser=window[a],b=b||this.options.parserConfig,b&&j.Parser.configure&&j.Parser.configure(b),this.container.firstChild&&(forEach(this.container.childNodes,function(a){a.nodeType!=3&&(a.dirty=!0)}),this.addDirtyNode(this.firstChild),this.scheduleHighlight())},keyDown:function(a){this.frozen=="leave"&&(this.frozen=null,this.keyFilter=null);if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode,a)))a.stop(),this.frozen(a);else{var b=a.keyCode;this.delayScanning(),this.options.autoMatchParens&&this.scheduleParenHighlight();if(b==13){if(a.ctrlKey&&!a.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor();var c=this.options.enterMode;c!="flat"&&this.indentAtCursor(c=="keep"?"keep":undefined),select.scrollToCursor(this.container)}a.stop()}else if(b==9&&this.options.tabMode!="default"&&!a.ctrlKey)this.handleTab(!a.shiftKey),a.stop();else if(b==32&&a.shiftKey&&this.options.tabMode=="default")this.handleTab(!0),a.stop();else if(b==36&&!a.shiftKey&&!a.ctrlKey)this.home()&&a.stop();else if(b==35&&!a.shiftKey&&!a.ctrlKey)this.end()&&a.stop();else if(b==33&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageUp()&&a.stop();else if(b==34&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageDown()&&a.stop();else if((b==219||b==221)&&a.ctrlKey&&!a.altKey)this.highlightParens(a.shiftKey,!0),a.stop();else if(a.metaKey&&!a.shiftKey&&(b==37||b==39)){var d=select.selectionTopNode(this.container);if(d===!1||!this.container.firstChild)return;if(b==37)select.focusAfterNode(f(d),this.container);else{var e=g(d,this.container);select.focusAfterNode(e?e.previousSibling:this.container.lastChild,this.container)}a.stop()}else(a.ctrlKey||a.metaKey)&&!a.altKey&&(a.shiftKey&&b==90||b==89?(select.scrollToNode(this.history.redo()),a.stop()):b==90||safari&&b==8?(select.scrollToNode(this.history.undo()),a.stop()):b==83&&this.options.saveFunction?(this.options.saveFunction(),a.stop()):b==86&&!mac&&this.reroutePasteEvent())}},keyPress:function(a){var b=this.options.electricChars&&j.Parser.electricChars,c=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode||a.code,a))||a.code==13||a.code==9&&this.options.tabMode!="default"||a.code==32&&a.shiftKey&&this.options.tabMode=="default")a.stop();else if(mac&&(a.ctrlKey||a.metaKey)&&a.character=="v")this.reroutePasteEvent();else if(b&&b.indexOf(a.character)!=-1)this.parent.setTimeout(function(){c.indentAtCursor(null)},0);else if(brokenOpera){if(a.code==8){var d=select.selectionTopNode(this.container),c=this,e=d?d.nextSibling:this.container.firstChild;d!==!1&&e&&isBR(e)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)==e&&select.focusAfterNode(e.previousSibling,c.container)},20)}else if(a.code==46){var d=select.selectionTopNode(this.container),c=this;d&&isBR(d)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)!=d&&select.focusAfterNode(d,c.container)},20)}}else if(slowWebkit){var d=select.selectionTopNode(this.container),e=d?d.nextSibling:this.container.firstChild;if(d&&e&&isBR(e)&&!isBR(d)){var f=document.createTextNode("â€‹");this.container.insertBefore(f,e),this.parent.setTimeout(function(){f.nodeValue=="â€‹"?removeElement(f):f.nodeValue=f.nodeValue.replace("â€‹","")},20)}}webkit&&!this.options.textWrapping&&setTimeout(function(){var a=select.selectionTopNode(c.container,!0);a&&a.nodeType==3&&a.previousSibling&&isBR(a.previousSibling)&&a.nextSibling&&isBR(a.nextSibling)&&a.parentNode.replaceChild(document.createElement("BR"),a.previousSibling)},50)},keyUp:function(a){this.cursorActivity(k(a.keyCode))},indentLineAfter:function(a,b){function c(a){var b=a?a.nextSibling:d.container.firstChild;if(!b||!hasClass(b,"whitespace"))return null;return b}var d=this,e=c(a),g=0,h=e?e.currentText.length:0,i=e?e.nextSibling:a?a.nextSibling:this.container.firstChild;if(b=="keep"){if(a){var k=c(f(a.previousSibling));k&&(g=k.currentText.length)}}else{var l=a&&i&&i.currentText?i.currentText:"";b!=null&&this.options.tabMode=="shift"?g=b?h+indentUnit:Math.max(0,h-indentUnit):a?g=a.indentation(l,h,b):j.Parser.firstIndentation&&(g=j.Parser.firstIndentation(l,h,b))}var m=g-h;m<0?g==0?(i&&select.snapshotMove(e.firstChild,i.firstChild||i,0),removeElement(e),e=null):(select.snapshotMove(e.firstChild,e.firstChild,m,!0),e.currentText=makeWhiteSpace(g),e.firstChild.nodeValue=e.currentText):m>0?e?(e.currentText=makeWhiteSpace(g),e.firstChild.nodeValue=e.currentText,select.snapshotMove(e.firstChild,e.firstChild,m,!0)):(e=makePartSpan(makeWhiteSpace(g)),e.className="whitespace",a?insertAfter(e,a):this.container.insertBefore(e,this.container.firstChild),select.snapshotMove(i&&(i.firstChild||i),e.firstChild,g,!1,!0)):e&&select.snapshotMove(e.firstChild,e.firstChild,g,!1),m!=0&&this.addDirtyNode(a)},highlightAtCursor:function(){var a=select.selectionTopNode(this.container,!0),b=select.selectionTopNode(this.container,!1);if(a===!1||b===!1)return!1;select.markSelection();if(this.highlight(a,g(b,this.container),!0,20)===!1)return!1;select.selectMarked();return!0},handleTab:function(a){this.options.tabMode=="spaces"?select.insertTabAtCursor():this.reindentSelection(a)},home:function(){var a=select.selectionTopNode(this.container,!0),b=a;if(a===!1||!(!a||a.isPart||isBR(a))||!this.container.firstChild)return!1;while(a&&!isBR(a))a=a.previousSibling;var c=a?a.nextSibling:this.container.firstChild;c&&c!=b&&c.isPart&&hasClass(c,"whitespace")?select.focusAfterNode(c,this.container):select.focusAfterNode(a,this.container),select.scrollToCursor(this.container);return!0},end:function(){var a=select.selectionTopNode(this.container,!0);if(a===!1)return!1;a=g(a,this.container);if(!a)return!1;select.focusAfterNode(a.previousSibling,this.container),select.scrollToCursor(this.container);return!0},pageUp:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===!1||b===!1)return!1;b-=2;for(var c=0;c<b;c++){a=this.prevLine(a);if(a===!1)break}if(c==0)return!1;select.setCursorPos(this.container,{node:a,offset:0}),select.scrollToCursor(this.container);return!0},pageDown:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===!1||b===!1)return!1;b-=2;for(var c=0;c<b;c++){var d=this.nextLine(a);if(d===!1)break;a=d}if(c==0)return!1;select.setCursorPos(this.container,{node:a,offset:0}),select.scrollToCursor(this.container);return!0},scheduleParenHighlight:function(){this.parenEvent&&this.parent.clearTimeout(this.parenEvent);var a=this;this.parenEvent=this.parent.setTimeout(function(){a.highlightParens()},300)},highlightParens:function(a,b){function n(){var a=[],b,c=!0;for(var d=j;d;d=l?d.nextSibling:d.previousSibling)if(d.className==k&&isSpan(d)&&(b=f(d))){h(b)==l?a.push(b):a.length?a.pop()!=matching[b]&&(c=!1):c=!1;if(!a.length)break}else if(d.dirty||!isSpan(d)&&!isBR(d))return{node:d,status:"dirty"};return{node:d,status:d&&c}}function h(a){return/[\(\[\{]/.test(a)}function f(a){if(a.currentText){var b=a.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return b&&b[1]}}function e(a){!a||(c.options.unmarkParen?c.options.unmarkParen(a):(a.style.fontWeight="",a.style.color=""))}function d(a,b){!a||(c.options.markParen?c.options.markParen(a,b):(a.style.fontWeight="bold",a.style.color=b?"#8F8":"#F88"))}var c=this;!b&&c.highlighted&&(e(c.highlighted[0]),e(c.highlighted[1]));if(!(!window||!window.parent||!window.select)){this.parenEvent&&this.parent.clearTimeout(this.parenEvent),this.parenEvent=null;var i,j=select.selectionTopNode(this.container,!0);if(!j||!this.highlightAtCursor())return;j=select.selectionTopNode(this.container,!0);if(!j||!((i=f(j))||(j=j.nextSibling)&&(i=f(j))))return;var k=j.className,l=h(i),m=matching[i];while(!0){var o=n();if(o.status=="dirty"){this.highlight(o.node,g(o.node)),o.node.dirty=!1;continue}d(j,o.status),d(o.node,o.status),b?c.parent.setTimeout(function(){e(j),e(o.node)},500):c.highlighted=[j,o.node],a&&o.node&&select.focusAfterNode(o.node.previousSibling,this.container);break}}},indentAtCursor:function(a){if(!!this.container.firstChild){if(!this.highlightAtCursor())return;var b=select.selectionTopNode(this.container,!1);if(b===!1)return;select.markSelection(),this.indentLineAfter(f(b),a),select.selectMarked()}},indentRegion:function(a,b,c){var d=a=f(a),e=a&&f(a.previousSibling);isBR(b)||(b=g(b,this.container)),this.addDirtyNode(a);do{var h=g(d,this.container);d&&this.highlight(e,h,!0),this.indentLineAfter(d,c),e=d,d=h}while(d!=b);select.setCursorPos(this.container,{node:a,offset:0},{node:b,offset:0})},cursorActivity:function(a){this.unloaded&&(window.document.designMode="off",window.document.designMode="on",this.unloaded=!1);if(internetExplorer){this.container.createTextRange().execCommand("unlink"),clearTimeout(this.saveSelectionSnapshot);var b=this;this.saveSelectionSnapshot=setTimeout(function(){var a=select.getBookmark(b.container);a&&(b.selectionSnapshot=a)},200)}var c=this.options.cursorActivity;if(!a||c){var d=select.selectionTopNode(this.container,!1);if(d===!1||!this.container.firstChild)return;d=d||this.container.firstChild,c&&c(d),a||(this.scheduleHighlight(),this.addDirtyNode(d))}},reparseBuffer:function(){forEach(this.container.childNodes,function(a){a.dirty=!0}),this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(a){a=a||this.container.firstChild;if(!!a){for(var b=0;b<this.dirty.length;b++)if(this.dirty[b]==a)return;a.nodeType!=3&&(a.dirty=!0),this.dirty.push(a)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var a=this;this.parent.clearTimeout(this.highlightTimeout),this.highlightTimeout=this.parent.setTimeout(function(){a.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){while(this.dirty.length>0){var a=this.dirty.pop();try{while(a&&a.parentNode!=this.container)a=a.parentNode;if(a&&(a.dirty||a.nodeType==3))return a}catch(b){}}return null},highlightDirty:function(a){if(!window||!window.parent||!window.select)return!1;this.options.readOnly||select.markSelection();var b,c=a?null:h()+this.options.passTime;while((h()<c||a)&&(b=this.getDirtyNode())){var d=this.highlight(b,c);d&&d.node&&d.dirty&&this.addDirtyNode(d.node.nextSibling)}this.options.readOnly||select.selectMarked(),b&&this.scheduleHighlight();return this.dirty.length==0},documentScanner:function(a){var b=this,c=null;return function(){if(!(!window||!window.parent||!window.select)){c&&c.parentNode!=b.container&&(c=null),select.markSelection();var d=b.highlight(c,h()+a,!0);select.selectMarked();var e=d?d.node&&d.node.nextSibling:null;c=c==e?null:e,b.delayScanning()}}},delayScanning:function(){this.scanner&&(this.parent.clearTimeout(this.documentScan),this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning))},highlight:function(a,b,c,e){function s(a){return(a.previousSibling==null||isBR(a.previousSibling))&&(a.nextSibling==null||isBR(a.nextSibling))}function o(a){if(a){var b=a.oldNextSibling;(u||b===undefined||a.nextSibling!=b)&&g.history.touch(a),a.oldNextSibling=a.nextSibling}else{var b=g.container.oldFirstChild;(u||b===undefined||g.container.firstChild!=b)&&g.history.touch(null),g.container.oldFirstChild=g.container.firstChild}}function n(a){var b=makePartSpan(a.value);b.className=a.style;return b}function m(a,b){a.currentText=a.currentText.substring(b),a.reduced=!0}function l(a,b){return!b.reduced&&b.currentText==a.value&&b.className==a.style}var f=this.container,g=this,i=this.options.activeTokens,k=typeof b=="number"?b:null;if(!f.firstChild)return!1;while(a&&(!a.parserFromHere||a.dirty)){if(e!=null&&isBR(a)&&--e<0)return!1;a=a.previousSibling}if(a&&!a.nextSibling)return!1;var p=d(a?a.nextSibling:f.firstChild),q=stringStream(p),r=a?a.parserFromHere(q):j.Parser.make(q),t={current:null,get:function(){this.current||(this.current=p.nodes.shift());return this.current},next:function(){this.current=null},remove:function(){f.removeChild(this.get()),this.current=null},getNonEmpty:function(){var a=this.get();while(a&&isSpan(a)&&a.currentText=="")if(window.opera&&s(a))this.next(),a=this.get();else{var b=a;this.remove(),a=this.get(),select.snapshotMove(b.firstChild,a&&(a.firstChild||a),0)}return a}},u=!1,v=!0,w=0;forEach(r,function(d){var e=t.getNonEmpty();if(d.value=="\n"){if(!isBR(e))throw"Parser out of sync. Expected BR.";if(e.dirty||!e.indentation)u=!0;o(a),a=e,e.parserFromHere=r.copy(),e.indentation=d.indentation||alwaysZero,e.dirty=!1;if(k==null&&e==b)throw StopIteration;if(k!=null&&h()>=k||!u&&!v&&w>1&&!c)throw StopIteration;v=u,u=!1,w=0,t.next()}else{if(!isSpan(e))throw"Parser out of sync. Expected SPAN.";e.dirty&&(u=!0),w++;if(l(d,e))e.dirty=!1,t.next();else{u=!0;var j=n(d);f.insertBefore(j,e),i&&i(j,d,g);var p=d.value.length,q=0;while(p>0){e=t.get();var s=e.currentText.length;select.snapshotReplaceNode(e.firstChild,j.firstChild,p,q),s>p?(m(e,p),p=0):(p-=s,q+=s,t.remove())}}}}),o(a),webkitLastLineHack(this.container);return{node:t.getNonEmpty(),dirty:u}}};return j}();addEventHandler(window,"load",function(){var a=window.frameElement.CodeMirror,b=a.editor=new Editor(a.options);this.parent.setTimeout(method(a,"init"),0)})